<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Ultracache by polidog</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Ultracache</h1>
        <p>ローカルとリモートのmemcachにキャッシュさせる的なあれ</p>

        <p class="view"><a href="https://github.com/polidog/Ultracache">View the Project on GitHub <small>polidog/Ultracache</small></a></p>


        <ul>
          <li><a href="https://github.com/polidog/Ultracache/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/polidog/Ultracache/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/polidog/Ultracache">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Ultracache</h1>

<p><img src="http://www.polidog.jp/images/tora.jpg" alt="うるとら"></p>

<p>ウルトラキャッシュはストレス発散とネタ的な意味をこめて、作ったPHPのライブラリです。
MemacheサーバとAPサーバが別サーバのときに、いちいちmemcacheからデータを取得するのって意外とネットワークの帯域を消費するんじゃないかと僕は思ったわけです。<br>
ローカルにキャッシュがあるときはローカルから取得して、無い場合はmemcaheから取得するみたいな感じの実装です。</p>

<p>一応Memcached以外にも対応できるようにドライバっぽく作ってあったりもします。</p>

<p>ちなみに、テストはしてないし、動作のチェックもしていません。
ただコードを書いただけなので、使う際は要注意してください。不具合があった場合はPull Request送ってもらえるとうれしいです。</p>

<h2>Installation  </h2>

<pre><code>pecl install memcached
pecl install apc
</code></pre>

<h2>Configurations</h2>

<pre><code>&lt;?php
$config = array(
    'remote'    =&gt; array( // リモート側
        'Memcached' =&gt; array(
            'servers' =&gt; array(
                array('localhost',11211), // memcachedのサーバ設定とおなじ
            ),
        ),
    ),
    'local'     =&gt; array( // AP側(実行しているPHPの鯖)
        'Apc' =&gt; array(), // 別に設定は特になし、でも空配列じゃないとだめだよー
    ),
);
</code></pre>

<h2>Usage</h2>

<p>一応PSR-0に従っているような気がするので適当にオートローダー用していただければ良いかと思います。
使い方は至って簡単。</p>

<pre><code>&lt;?php
require __DIR__ . '/../vendor/autoload.php';
$config = array(
    'remote'    =&gt; array( // リモート側
        'Memcached' =&gt; array(
            'servers' =&gt; array(
                array('localhost',11211), // memcachedのサーバ設定とおなじ
            ),
        ),
    ),
    'local'     =&gt; array( // AP側(実行しているPHPの鯖)
        'Apc' =&gt; array(), // 別に設定は特になし、でも空配列じゃないとだめだよー
    ),
);

try { 
    $cache = new Ultracache\Ultracache($config);
    $cache-&gt;set('test','cachetest'); // キャッシュをセット
    var_dump($cache-&gt;get('test')); // キャッシュをゲット

} catch (Ultracache\Exception\NosupportDriverException $noe ) {
    echo $noe-&gt;getMessage();
    echo "\n";
}
</code></pre>

<p>たぶん、サンプルを見ればわかるかと思います。
キャッシュが無い場合はmemcachedとローカルのAPCキャッシュに保存して、キャッシュがローカルにある場合は、ローカルからのみキャッシュを取得して、ローカルに無い場合はmemcacheから取得して、ローカルのAPCにキャッシュを入れるような仕組みになっています。<br>
ほかのAPサーバとのキャッシュの同期とかはいれていないので、比較的変更の少ないデータをキャッシュすることをお勧めします。</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/polidog">polidog</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>